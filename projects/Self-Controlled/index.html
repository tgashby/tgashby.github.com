<!DOCTYPE html>

<html lang="en">
	<head>
		<title>Self Control'd</title>
		
		<script type="text/javascript" src="js/Globals.js"></script>
		<script type="text/javascript" src="js/Input.js"></script>
		<script type="text/javascript" src="js/Player.js"></script>
		
		<script type="text/javascript">
		var mousePos;
		
		window.addEventListener('keyup', function(event)
		{
			Key.onKeyup(event);
		}, false);
		
		window.addEventListener('keydown', function(event)
		{
			Key.onKeydown(event);
		}, false);

		window.addEventListener('mousemove', function(event)
		{
			mousePos = Mouse.getPosition(document.getElementById("478Canvas"), event);
		}, false);
		
		window.addEventListener('click', function(event)
		{
			// var canvas = document.getElementById("478Canvas");
			// var ctx = canvas.getContext("2d");
// 			
			// ctx.moveTo(0, 0);
			// ctx.lineTo(mousePos.x, mousePos.y);
			// ctx.stroke();
		}, false);
		
		var Game =
		{
			fps : 60,
			width : 800,
			height : 600
		};

		Game.onEachFrame = (function()
		{
			var requestAnimationFrame = window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;

			if(requestAnimationFrame)
			{
				return function(cb)
				{
					var callB = function() 
					{
					  cb();
					  requestAnimationFrame(callB);
					}
					callB();
				};
			}
			else
			{
				return function(cb)
				{
					setInterval(cb, 1000 / Game.fps);
				}
			}
		})();
		
		Game.start = function()
		{
			Game.canvas = document.getElementById("478Canvas");
			Game.context = Game.canvas.getContext("2d");
			
			Game.player = new Player();
			
			Game.onEachFrame(Game.run);
		};
		
		Game.run = (function()
		{
			var loops = 0;
			var skipTicks = 1000 / Game.fps;
			var maxFrameSkip = 10;
			var nextGameTick = (new Date).getTime();
			var lastGameTick = 0;
			
			return function()
			{
				loops = 0;
				
				while ((new Date).getTime() > nextGameTick)
				{
					Game.update();
					nextGameTick += skipTicks;
					loops++;
				}
				
				if (loops)
					Game.draw();
			}
		})();
		
		Game.draw = function()
		{
			Game.context.clearRect(0, 0, Game.width, Game.height);
			Game.player.draw(Game.context);
		}
		
		Game.update = function() 
		{
	      Game.player.update();
	    };
		</script>
	</head>
	
	<body onload="Game.start()">
		<canvas id="478Canvas" width="800" height="600"></canvas>
	</body>
</html>
